import{f as B,r as d,j as e,u as A,v as N,d as P,e as y,L as F,T as w,A as T}from"./index-CRMG5bzS.js";import{B as $,C as M,H as _,f as L}from"./loan-f7_xqhB8.js";import{L as V}from"./library-big-LrgyZfRD.js";import{C as O,a as G,T as z}from"./trending-up-down-DloR7GsE.js";import{D as U}from"./index-D2SIzbjx.js";import{B as H,f as E}from"./text-DC-W0PyF.js";import{B as S}from"./badge-DiIJR_EX.js";import{B as b}from"./use-form-control-CQKzOfDr.js";import{D as J}from"./download-CcwuIIIl.js";import{e as q}from"./excelExport-BIpDu_Yb.js";import"./fade-BWbPEriw.js";import"./select-C_HCPDtk.js";import"./key-BWXZw050.js";import"./children-aMr2zYAb.js";import"./xlsx-3SA47z_C.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]],W=B("badge-dollar-sign",K);function Z(){const[t,l]=d.useState({disbursed:0,approved:0,rejected:0,pending:0,total:0}),[n,c]=d.useState(!0);d.useEffect(()=>{(async()=>{try{c(!0);const g=(await L()).result,v={disbursed:g.filter(u=>u.status==="DISBURSED").length,approved:g.filter(u=>u.status==="APPROVED").length,rejected:g.filter(u=>u.status==="REJECTED").length,pending:g.filter(u=>u.status==="PENDING").length,total:g.length};l(v)}catch(p){console.error("Error fetching loan stats:",p)}finally{c(!1)}})()},[]);const o=s=>s.toLocaleString(),f=[{id:1,title:"Disbursed Loans",icon:W,count:o(t.disbursed),color:"#8280FF",percentage:m(t.disbursed,t.total)},{id:2,title:"Approved Loans",icon:$,count:o(t.approved),color:"#FEC53D",percentage:m(t.approved,t.total)},{id:3,title:"Rejected Loans",icon:M,count:o(t.rejected),color:"#4AD991",percentage:m(t.rejected,t.total)},{id:4,title:"Pending Loans",icon:_,count:o(t.pending),color:"#FF9066",percentage:m(t.pending,t.total)},{id:5,title:"Total Loans",icon:V,count:o(t.total),color:"#9F7AEA",percentage:"100%"}];function m(s,p){return p===0?"0%":`${(s/p*100).toFixed(1)}%`}return n?e.jsx("div",{children:"Loading loan statistics..."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 w-full",children:f.map((s,p)=>e.jsx(O,{className:"w-full transition-all duration-300 ease-in-out hover:border-black hover:border-2 hover:shadow-xl hover:-translate-y-1 cursor-pointer",children:e.jsxs(G,{className:"shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:s.title}),e.jsx("p",{className:"text-2xl font-bold",children:s.count})]}),e.jsx("div",{className:"p-2 rounded-lg transition-transform duration-300 hover:scale-110",style:{background:s.color},children:e.jsx(s.icon,{size:20,color:"white"})})]}),e.jsxs("p",{className:"flex items-center gap-2 pt-4 text-sm text-gray-500",children:[e.jsx(z,{size:16,color:"#38A169"}),e.jsxs("span",{children:[s.percentage," ",s.id!==5?"of total loans":""]})]})]})},s.id))})}const i=({label:t,value:l})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:t}),e.jsx("p",{className:"font-medium text-lg",children:l})]}),x=({filename:t,label:l})=>{const n=A(),c=async()=>{if(t)try{const o=await y.get(`/api/file/download/${t}`,{responseType:"blob"}),f=new Blob([o.data]),m=window.URL.createObjectURL(f),s=document.createElement("a");s.href=m,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(m)}catch(o){console.error("Download error:",o),n({title:"Failed to download file",status:"error"})}};return t?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between border border-gray-200 py-2 px-2 rounded-lg bg-gray-100 hover:border-blue-300 transition-colors",children:[e.jsxs("span",{className:"text-sm font-bold text-gray-700",children:["⦿ ",l]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(b,{size:"sm",colorScheme:"green",variant:"ghost",leftIcon:e.jsx(J,{size:16}),onClick:c,children:"Download"})})]})}):e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:l}),e.jsx(E,{fontSize:"sm",color:"gray.500",children:"No file uploaded"})]})},Q=({data:t})=>{const l=A(),[n,c]=d.useState(!1),o=async()=>{c(!0);try{await y.post(`/api/loan/${t.id}/approve`),window.location.reload()}catch{l({title:"Failed to approve loan",status:"error"})}finally{c(!1)}},f=async()=>{try{await y.post(`/api/loan/${t.id}/reject`),window.location.reload()}catch{l({title:"Failed to reject loan",status:"error"})}finally{c(!1)}},m=async()=>{try{await y.post(`/api/loan/${t.id}/disburse`),window.location.reload()}catch{l({title:"Failed to disburse loan",status:"error"})}finally{c(!1)}};return e.jsxs(H,{bg:"white",borderRadius:"lg",boxShadow:"md",children:[e.jsx("div",{className:"bg-[#2D9CDB] text-white p-4 rounded-t-lg",children:e.jsx("p",{className:"font-semibold",children:"Details"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(i,{label:"Member Name",value:`${t.member.full_name}`}),e.jsx(i,{label:"Servicing Loan",value:`${t.servicingLoan}`}),e.jsx(i,{label:"Loan ID",value:`${t.id}`}),e.jsx(i,{label:"Loan Category",value:`${t.category.name}`}),e.jsx(i,{label:"Reference",value:t.reference}),e.jsx(i,{label:"Amount",value:`₦${t.amount}`}),e.jsx(i,{label:"Approved Amount",value:`₦${t.approvedAmount}`}),e.jsx(i,{label:"Months",value:t.durationMonths}),e.jsx(i,{label:"Interest Rate",value:`${t.interestRate}%`}),e.jsx(i,{label:"Date Applied",value:`${N(t.createdAt)}`}),e.jsx(i,{label:"Date Approved",value:t.start_date?N(t.start_date):"N/A"}),e.jsx(i,{label:"Status",value:e.jsx(S,{colorScheme:t.status==="APPROVED"?"green":t.status==="PENDING"||t.status==="PENDING_VERIFICATION"?"yellow":"red",px:3,py:1,borderRadius:"full",children:t.status})})]}),e.jsx("div",{children:e.jsx(P,{})})]}),e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsx("p",{className:"text-lg font-bold pb-4",children:"Supporting Documents"}),e.jsx(x,{filename:t.nonIndebtedness,label:"Letter of Non-Indebtedness"}),e.jsx(x,{filename:t.validId,label:"Valid ID"}),e.jsx(x,{filename:t.application,label:"Application Letter"}),e.jsx(x,{filename:t.incomeProof,label:"Income Proof"}),e.jsx(x,{filename:t.accountStatement,label:"Account Statement"}),e.jsx(x,{filename:t.utilityBill,label:"Utility Bill"}),e.jsx(x,{filename:t.guarantorLetter,label:"Guarantor Letter"}),e.jsx(x,{filename:t.guarantorPassport,label:"Guarantor Passport"}),e.jsx(x,{filename:t.personalPassport,label:"Personal Passport"})]}),e.jsxs("div",{className:"flex gap-5 mt-8",children:[t.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(b,{isLoading:n,w:"30%",colorScheme:"green",onClick:o,children:"Approve"}),e.jsx(b,{isLoading:n,w:"30%",colorScheme:"red",onClick:f,children:"Reject"})]}),t.status==="APPROVED"&&e.jsx(b,{isLoading:n,w:"30%",colorScheme:"blue",onClick:m,children:"Disburse"}),t.status==="REJECTED"&&e.jsx(E,{color:"red.500",fontStyle:"italic",children:"This loan application has been rejected"})]})]})]})},X=[{title:"ID",dataIndex:"id",key:"id"},{title:"Members Name",dataIndex:"member",key:"member",render:t=>e.jsxs("span",{className:"font-semibold flex items-center gap-2",children:[e.jsx(T,{src:t.full_name,size:"sm"}),`${t?.full_name}`||"N/A"]})},{title:"Loan Reference",dataIndex:"reference",key:"reference"},{title:"Date",dataIndex:"createdAt",key:"createdAt",render:t=>new Date(t).toLocaleDateString()},{title:"Amount",dataIndex:"amount",key:"amount",render:t=>e.jsxs("span",{className:"font-semibold",children:["₦",t]})},{title:"Approved Amount",dataIndex:"approvedAmount",key:"approvedAmount",render:t=>e.jsxs("span",{className:"font-semibold",children:["₦",t]})},{title:"Approved By",dataIndex:"approvedBy",key:"approvedBy",render:t=>t?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.full_name}),e.jsx("span",{className:"text-xs text-gray-500",children:t.email})]}):e.jsx("span",{className:"text-gray-400",children:"Not approved"})},{title:"Rejected By",dataIndex:"rejectedBy",key:"rejectedBy",render:t=>t?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.full_name}),e.jsx("span",{className:"text-xs text-gray-500",children:t.email})]}):e.jsx("span",{className:"text-gray-400",children:"Not rejected"})},{title:"Status",dataIndex:"status",key:"status",render:t=>e.jsx(S,{colorScheme:t==="APPROVED"?"green":t==="PENDING"?"yellow":t==="PENDING_VERIFICATION"?"blue":t==="DISBURSED"?"purple":"red",px:3,py:1,borderRadius:"full",textTransform:"capitalize",children:t})}],Y=[{name:"All Loans",filter:"all"},{name:"Approved Loan",filter:"APPROVED"},{name:"Disbursed Loan",filter:"ACTIVE"},{name:"Pending Approval",filter:"PENDING"},{name:"Rejected Loan Request",filter:"REJECTED"}];function ee(){const[t,l]=d.useState(null),[n,c]=d.useState("all"),[o,f]=d.useState([]),[m,s]=d.useState(!0),[p,g]=d.useState(null);d.useEffect(()=>{(async()=>{try{s(!0);const h=await L();f(h.result)}catch(h){g("Failed to fetch loans"),console.error(h)}finally{s(!1)}})()},[]);const v=a=>{l(a)},u=()=>{l(null)},R=a=>{c(a)},D=d.useMemo(()=>n==="all"?o:o.filter(a=>a.status===n),[n,o]),I=d.useMemo(()=>{const a=o.filter(j=>j.status==="APPROVED").length,h=o.filter(j=>j.status==="PENDING").length,r=o.filter(j=>j.status==="REJECTED").length,C=o.filter(j=>j.status==="ACTIVE").length;return{all:o.length,APPROVED:a,DISBURSED:C,PENDING:h,REJECTED:r}},[o]),k=Y.map(a=>({...a,name:`${a.name} (${I[a.filter]||0})`}));return m?e.jsx("div",{children:e.jsx(F,{})}):p?e.jsx("div",{children:p}):t?e.jsxs("div",{className:"mt-7",children:[e.jsx(b,{onClick:u,mb:4,variant:"outline",children:"Back to List"}),e.jsx(Q,{data:t})]}):e.jsxs("div",{className:"mt-15",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:k.map((a,h)=>e.jsx(b,{onClick:()=>R(a.filter),variant:n===a.filter?"solid":"outline",colorScheme:n===a.filter?"blue":"gray",size:"sm",className:"transition-all duration-200",children:a.name},h))}),e.jsxs("button",{style:{background:"green",color:"white",padding:"8px 16px",borderRadius:"5px",border:"none",cursor:"pointer"},onClick:()=>{try{const a=D.map(r=>({ID:r.id,"Member Name":`${r.member.full_name}`,"Loan Reference":r.reference,"Date Applied":new Date(r.createdAt).toLocaleDateString(),Amount:r.amount.toString(),"Approved Amount":r.approvedAmount?r.approvedAmount.toString():"N/A","Approved By":r.approvedBy?r.approvedBy.full_name:"Not approved","Rejected By":r.rejectedBy?r.rejectedBy.full_name:"Not rejected",Status:r.status,"Interest Rate":r.interestRate?r.interestRate.toString():"N/A","Duration (Months)":r.durationMonths?r.durationMonths.toString():"N/A","Start Date":r.startDate?new Date(r.startDate).toLocaleDateString():"N/A","End Date":r.endDate?new Date(r.endDate).toLocaleDateString():"N/A"}));if(a.length===0){w({title:"No loan to export",status:"warning"});return}q({data:a,columns:[{key:"ID",header:"ID",width:10},{key:"Member Name",header:"Member Name",width:20},{key:"Loan Reference",header:"Loan Reference",width:18},{key:"Date Applied",header:"Date Applied",width:15},{key:"Amount",header:"Amount",width:15},{key:"Approved Amount",header:"Approved Amount",width:18},{key:"Approved By",header:"Approved By",width:20},{key:"Rejected By",header:"Rejected By",width:20},{key:"Status",header:"Status",width:15},{key:"Interest Rate",header:"Interest Rate",width:15},{key:"Duration (Months)",header:"Duration (Months)",width:18},{key:"Start Date",header:"Start Date",width:15},{key:"End Date",header:"End Date",width:15}],filename:`loans_${n}_${new Date().toISOString().slice(0,10)}.xlsx`,sheetName:"Loans",title:`${n==="all"?"All":n.charAt(0)+n.slice(1).toLowerCase()} Loans Report`}),console.log(`Successfully exported ${a.length} loans`)}catch(a){console.error("Export failed:",a),w({title:"Export Failed",status:"error"})}},children:["Export (",D.length,")"]})]}),e.jsx(U,{data:D,columns:X,rowKey:"id",showExport:!0,showFilters:!0,tableHeaderBg:"#F1F4F9",tableHeaderColor:"black",onRowClick:v})]})}const fe=()=>e.jsxs("div",{className:"w-full gap-4 mt-4",children:[e.jsx(Z,{}),e.jsx(ee,{})]});export{fe as default};
