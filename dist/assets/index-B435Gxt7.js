import{f as W,r,j as e,e as N}from"./index-CRMG5bzS.js";import{D as Y,E as Z}from"./index-D2SIzbjx.js";import{I as ee}from"./input-BfnAPdur.js";import{S as se}from"./select-C_HCPDtk.js";import{M as y,a as b,b as v,c as w,d as A,e as C}from"./modal-overlay-DqBh97wO.js";import{B as i}from"./use-form-control-CQKzOfDr.js";import{u as E,C as R,a as P}from"./circle-x-KiDpDjvU.js";import{M}from"./modal-footer-CYNbZFBh.js";import"./text-DC-W0PyF.js";import"./children-aMr2zYAb.js";import"./fade-BWbPEriw.js";import"./key-BWXZw050.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ae=W("clock",te);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],I=W("refresh-cw",re),ge=()=>{const[l,T]=r.useState([]),[_,k]=r.useState([]),[F,D]=r.useState(!0),[m,B]=r.useState("ALL"),[c,q]=r.useState(""),[t,G]=r.useState(null),[j,L]=r.useState(""),[S,x]=r.useState(!1),{isOpen:V,onOpen:J,onClose:h}=E(),{isOpen:$,onOpen:H,onClose:g}=E(),{isOpen:Q,onOpen:z,onClose:f}=E(),u=async()=>{D(!0);try{const s=await N.get("/api/withdrawal/admin");if(s.data?.success){const a=s.data.data.map(n=>({...n,amount:typeof n.amount=="string"?parseFloat(n.amount):n.amount}));T(a),k(a)}}catch(s){console.error("Error fetching withdrawals:",s)}finally{D(!1)}};r.useEffect(()=>{u()},[]),r.useEffect(()=>{let s=l;m!=="ALL"&&(s=s.filter(a=>a.status===m)),c&&(s=s.filter(a=>a.reference.toLowerCase().includes(c.toLowerCase())||a.member.full_name.toLowerCase().includes(c.toLowerCase())||a.member.email.toLowerCase().includes(c.toLowerCase()))),k(s)},[m,c,l]);const K=async()=>{if(t){x(!0);try{(await N.patch(`/api/withdrawal/${t.id}/approve`)).data?.success&&(await u(),g(),h())}catch(s){console.error("Error approving withdrawal:",s),alert(s.response?.data?.error||"Failed to approve withdrawal")}finally{x(!1)}}},U=async()=>{if(!t||!j.trim()){alert("Please provide a rejection reason");return}x(!0);try{(await N.patch(`/api/withdrawal/${t.id}/reject`,{rejectionReason:j})).data?.success&&(await u(),f(),h(),L(""))}catch(s){console.error("Error rejecting withdrawal:",s),alert(s.response?.data?.error||"Failed to reject withdrawal")}finally{x(!1)}},O=s=>{const a={PENDING:"bg-yellow-100 text-yellow-800",APPROVED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800",COMPLETED:"bg-blue-100 text-blue-800"},n={PENDING:e.jsx(ae,{className:"w-4 h-4"}),APPROVED:e.jsx(R,{className:"w-4 h-4"}),REJECTED:e.jsx(P,{className:"w-4 h-4"}),COMPLETED:e.jsx(R,{className:"w-4 h-4"})};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${a[s]}`,children:[n[s],s]})},p=s=>s?new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",o=s=>{const a=typeof s=="string"?parseFloat(s):s;return new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(a)},d={total:l.length,pending:l.filter(s=>s.status==="PENDING").length,approved:l.filter(s=>s.status==="COMPLETED").length,rejected:l.filter(s=>s.status==="REJECTED").length,totalAmount:l.reduce((s,a)=>{const n=typeof a.amount=="string"?parseFloat(a.amount):a.amount;return s+n},0)},X=[{title:"Reference",dataIndex:"reference",key:"reference",render:s=>e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s||"N/A"})},{title:"Member",dataIndex:"member",key:"member",render:s=>s?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.first_name||""," ",s.last_name||""]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email||"N/A"})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"N/A"})},{title:"Amount",dataIndex:"amount",key:"amount",render:s=>e.jsx("div",{className:"text-sm font-bold text-gray-900",children:s?o(s):"N/A"})},{title:"Category",dataIndex:"category",key:"category",render:s=>s?e.jsx("div",{className:"text-sm text-gray-900",children:s.name||"N/A"}):e.jsx("div",{className:"text-sm text-gray-500",children:"N/A"})},{title:"Status",dataIndex:"status",key:"status",render:s=>s?O(s):e.jsx("span",{children:"N/A"})},{title:"Date",dataIndex:"requestedAt",key:"requestedAt",render:s=>e.jsx("div",{className:"text-sm text-gray-900",children:p(s)})}];return F?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:"Withdrawal"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Requests"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mt-2",children:d.total})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600 mt-2",children:d.pending})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Approved"}),e.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:d.approved})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Rejected"}),e.jsx("div",{className:"text-2xl font-bold text-red-600 mt-2",children:d.rejected})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Amount"}),e.jsx("div",{className:"text-xl font-bold text-blue-600 mt-2",children:o(d.totalAmount)})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx(ee,{type:"text",placeholder:"Search by reference, name, or email...",value:c,onChange:s=>q(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),e.jsx("div",{className:"relative",children:e.jsxs(se,{value:m,onChange:s=>B(s.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white",children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"}),e.jsx("option",{value:"COMPLETED",children:"Completed"})]})}),e.jsxs("button",{onClick:u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Refresh"]})]})}),e.jsx(Y,{data:_,columns:X,rowKey:"id",actionButtons:[{name:"View Details",icon:e.jsx(Z,{className:"w-4 h-4"}),colorScheme:"blue",variant:"solid",onClick:s=>{s.length>0&&(G(s[0]),J())}}],showActionBar:!0})]}),e.jsxs(y,{isOpen:V,onClose:h,size:"xl",children:[e.jsx(b,{}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Withdrawal Details"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t?.reference||"N/A"})]})}),e.jsx(A,{}),e.jsx(C,{children:t&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:O(t.status)}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Member Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Full Name:"}),e.jsx("span",{className:"font-medium",children:t.member?.full_name||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Email:"}),e.jsx("span",{className:"font-medium",children:t.member?.email||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Phone:"}),e.jsx("span",{className:"font-medium",children:t.member?.phone||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Withdrawal Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsx("span",{className:"font-bold text-lg",children:o(t.amount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"font-medium",children:t.category?.name||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Requested:"}),e.jsx("span",{className:"font-medium",children:p(t.requestedAt)})]}),t.reason&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Reason:"}),e.jsx("span",{className:"font-medium",children:t.reason})]}),t.approvedAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Approved:"}),e.jsx("span",{className:"font-medium",children:p(t.approvedAt)})]}),t.rejectedAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Rejected:"}),e.jsx("span",{className:"font-medium",children:p(t.rejectedAt)})]}),t.rejectionReason&&e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-gray-600 block mb-2",children:"Rejection Reason:"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-3 text-red-800",children:t.rejectionReason})]})]})]}),t.status==="PENDING"&&e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(i,{onClick:H,colorScheme:"green",className:"flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 font-medium",children:[e.jsx(R,{className:"w-5 h-5"}),"Approve"]}),e.jsxs(i,{onClick:z,colorScheme:"red",className:"flex-1 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 flex items-center justify-center gap-2 font-medium",children:[e.jsx(P,{className:"w-5 h-5"}),"Reject"]})]})]})}),e.jsx(M,{children:e.jsx(i,{onClick:h,children:"Close"})})]})]}),e.jsxs(y,{isOpen:$,onClose:g,children:[e.jsx(b,{}),e.jsxs(v,{children:[e.jsx(w,{children:"Approve Withdrawal"}),e.jsx(A,{}),e.jsxs(C,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to approve this withdrawal?"}),t&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:"Amount:"})," ",o(t.amount)]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Member:"})," ",t.member?.full_name||"N/A"," "]})]})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",mr:3,onClick:g,children:"Cancel"}),e.jsx(i,{colorScheme:"green",onClick:K,isLoading:S,children:"Approve"})]})]})]}),e.jsxs(y,{isOpen:Q,onClose:f,children:[e.jsx(b,{}),e.jsxs(v,{children:[e.jsx(w,{children:"Reject Withdrawal"}),e.jsx(A,{}),e.jsxs(C,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Please provide a reason for rejection"}),e.jsxs("div",{className:"space-y-4",children:[t&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:"Amount:"})," ",o(t.amount)]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Member:"})," ",t.member?.full_name||"N/A"," "]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rejection Reason *"}),e.jsx("textarea",{value:j,onChange:s=>L(s.target.value),placeholder:"Enter reason for rejection...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,required:!0})]})]})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",mr:3,onClick:f,children:"Cancel"}),e.jsx(i,{colorScheme:"red",onClick:U,isLoading:S,children:"Reject"})]})]})]})]})};export{ge as default};
