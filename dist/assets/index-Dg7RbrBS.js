import{f as L,u as B,r as d,j as e,H as Z,A as ee,e as E,t as se}from"./index-CRMG5bzS.js";import{X as te,D as re,E as le,T as ae}from"./index-D2SIzbjx.js";import{u as k,C as ie,a as ne}from"./circle-x-KiDpDjvU.js";import{B as N,T as R,a as _,b as w,c as o,d as H,e as c,f as oe}from"./text-DC-W0PyF.js";import{U as ce,u as de}from"./useMember-CGHURifS.js";import{M as me}from"./mail-ByhDhK2S.js";import{M,a as T,b as z,c as A,d as F,e as I}from"./modal-overlay-DqBh97wO.js";import{B as V}from"./badge-DiIJR_EX.js";import{B as O}from"./use-form-control-CQKzOfDr.js";import{e as he}from"./excelExport-BIpDu_Yb.js";import{I as xe}from"./input-BfnAPdur.js";import"./fade-BWbPEriw.js";import"./select-C_HCPDtk.js";import"./key-BWXZw050.js";import"./children-aMr2zYAb.js";import"./xlsx-3SA47z_C.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M16 2v6h6",key:"1mfrl5"}],["path",{d:"m22 2-6 6",key:"6f0sa0"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],ue=L("phone-incoming",pe);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 22V2",key:"zs6s6o"}]],fe=L("shield-half",je);function ge({data:t}){const m=B(),[l,b]=d.useState([]),[x,u]=d.useState([]),{isOpen:i,onOpen:a,onClose:S}=k(),{isOpen:y,onOpen:p,onClose:n}=k(),C=async()=>{try{const r=await E.get(`/api/members/${t.id}/savings`);b(r.data),a()}catch{m({title:"Error",description:"Failed to fetch savings history",status:"error"})}},D=async()=>{try{const r=await E.get(`/api/members/${t.id}/loans`);u(r.data),p()}catch{m({title:"Error",description:"Failed to fetch loan history",status:"error"})}};return e.jsxs(N,{bg:"white",borderRadius:"lg",boxShadow:"md",children:[e.jsx("div",{className:"p-4",children:e.jsx(N,{position:"fixed",top:"0",left:"0",width:"100vw",height:"103vh",backgroundColor:"rgba(128, 128, 128, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -top-7 -right-8 z-10",children:e.jsx("div",{style:{border:"1px solid white"},className:"bg-transparent rounded-full p-2 shadow-lg cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>window.location.reload(),children:e.jsx(te,{size:20,color:"white"})})}),e.jsx("div",{className:"bg-[#F2F7FA] rounded-lg p-6 shadow-xl",children:e.jsxs("div",{style:{border:"1px solid gray"},children:[e.jsxs("div",{className:"rounded flex gap-2",children:[e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"bg-white rounded text-xs p-4 px-8 flex flex-col gap-2",children:[e.jsx("p",{className:"font-semibold",children:"Member's Name"}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:10}),t.full_name]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(fe,{size:10}),t.username]})]}),e.jsxs("div",{className:"bg-white rounded text-xs p-4 px-8 flex flex-col gap-2 mt-2",children:[e.jsx("p",{className:"font-semibold",children:"Member's Information"}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ue,{size:10}),t.phone]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(me,{size:10}),t.email]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:10}),t.address]})]}),e.jsxs("div",{className:"bg-white rounded text-xs p-4 px-8 flex flex-col gap-2 mt-2",children:[e.jsx("p",{className:"font-semibold",children:"Service Information"}),e.jsxs("p",{className:"flex items-center gap-2",children:["ID: ",t.id]}),e.jsxs("p",{className:"flex items-center gap-2",children:["Account Number: ",t.bank[0].account_number]}),e.jsxs("p",{className:"flex items-center gap-2",children:["Date Joined: ",t.created_at.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col justify-center items-center pt-2",children:e.jsx(ee,{size:"xl",name:`${t.full_name}`})}),e.jsx("p",{className:"pt-4 font-semibold",children:t.full_name})]})]}),e.jsx("div",{className:"bg-[#556308] p-1",children:e.jsx("p",{className:"text-white",children:"Quick links"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 px-2 text-[#556308] py-2",children:[e.jsx("p",{className:"underline cursor-pointer",onClick:C,children:"View Savings History"}),e.jsx("p",{className:"underline cursor-pointer",children:"Update Member Balance"}),e.jsx("p",{className:"underline cursor-pointer",onClick:D,children:"View Loan History"}),e.jsx("p",{className:"underline cursor-pointer",children:"Download"})]})]})})]})})}),e.jsxs(M,{isOpen:i,onClose:S,size:"5xl",children:[e.jsx(T,{}),e.jsxs(z,{children:[e.jsxs(A,{children:["Savings History for ",t.full_name]}),e.jsx(F,{}),e.jsx(I,{children:e.jsxs(R,{variant:"simple",children:[e.jsx(_,{children:e.jsxs(w,{children:[e.jsx(o,{children:"Date"}),e.jsx(o,{children:"Reference"}),e.jsx(o,{children:"Transaction Type"}),e.jsx(o,{children:"Amount (â‚¦)"}),e.jsx(o,{children:"Status"})]})}),e.jsx(H,{children:l.map(r=>{const j=parseFloat(r.amount)>0;return e.jsxs(w,{children:[e.jsx(c,{children:new Date(r.createdAt).toLocaleDateString()}),e.jsx(c,{children:r.reference}),e.jsx(c,{children:e.jsx(N,{display:"inline-flex",alignItems:"center",px:2,py:1,borderRadius:"md",bg:j?"green.100":"red.100",color:j?"green.800":"red.800",children:j?"Deposit":"Withdrawal"})}),e.jsxs(c,{fontWeight:"semibold",children:[j?"+":"",parseFloat(r.amount).toLocaleString("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:2})]}),e.jsx(c,{children:e.jsx(N,{display:"inline-flex",alignItems:"center",px:2,py:1,borderRadius:"md",bg:r.status==="COMPLETED"?"blue.100":"yellow.100",color:r.status==="COMPLETED"?"blue.800":"yellow.800",children:r.status})})]},r.id)})})]})})]})]}),e.jsxs(M,{isOpen:y,onClose:n,size:"6xl",children:[e.jsx(T,{}),e.jsxs(z,{children:[e.jsxs(A,{children:["Loan History for ",t.full_name," (",x.length," loans)"]}),e.jsx(F,{}),e.jsx(I,{mb:6,children:e.jsx(N,{overflowX:"auto",children:e.jsxs(R,{size:"md",children:[e.jsx(_,{bg:"gray.100",children:e.jsxs(w,{children:[e.jsx(o,{children:"Reference"}),e.jsx(o,{children:"Amount"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Date"})]})}),e.jsx(H,{children:x.map(r=>e.jsxs(w,{children:[e.jsx(c,{fontWeight:"semibold",children:r.reference}),e.jsx(c,{children:parseFloat(r.approvedAmount).toLocaleString("en-NG",{style:"currency",currency:"NGN"})}),e.jsx(c,{children:e.jsx(V,{colorScheme:r.status==="APPROVED"?"green":r.status==="REJECTED"?"red":"yellow",px:2,py:1,borderRadius:"md",children:r.status.replace("_"," ")})}),e.jsx(c,{children:new Date(r.createdAt).toLocaleDateString()})]},r.id))})]})})})]})]})]})}function be({isOpen:t,onClose:m,status:l,title:b,message:x}){const u=se(l==="success"?"green":"red",l==="success"?"green":"red");return e.jsxs(M,{isOpen:t,onClose:m,isCentered:!0,children:[e.jsx(T,{}),e.jsxs(z,{children:[e.jsx(A,{children:b}),e.jsx(F,{}),e.jsxs(I,{className:"flex flex-col items-center p-6",children:[l==="success"?e.jsx(ie,{size:48,color:u}):e.jsx(ne,{size:48,color:u}),e.jsx(oe,{mt:4,textAlign:"center",children:x}),e.jsx(O,{colorScheme:l==="success"?"green":"red",mt:6,onClick:m,mb:6,children:"Close"})]})]})]})}const ye=[{title:"ID",dataIndex:"id",key:"id",width:70,render:t=>e.jsx("span",{className:"font-semibold",children:t})},{title:"Full Name",dataIndex:"full_name",key:"first_name"},{title:"Phone Number",dataIndex:"phone",key:"phoneNumber"},{title:"Email",dataIndex:"email",key:"email",render:t=>e.jsx("a",{href:`mailto:${t}`,className:"text-blue-500 hover:underline",children:t})},{title:"Status",dataIndex:"status",key:"status",render:t=>e.jsx(V,{colorScheme:t==="APPROVED"?"green":t==="PENDING"?"yellow":"red",px:3,py:1,borderRadius:"full",textTransform:"capitalize",children:t})}],Ne=[{name:"Total Members",filter:"all"}];function ve(){const[t,m]=d.useState(null),[l,b]=d.useState("all"),[x,u]=d.useState(""),i=B(),{members:a,loading:S,pagination:y,loadMembers:p}=de(),[n,C]=d.useState({page:1,limit:10}),D=()=>a.map(s=>({ID:s.id,"Full Name":s.full_name,"Phone Number":s.phone,Email:s.email,username:s.username||"N/A",Status:s.status})),{isOpen:r,onOpen:j,onClose:$}=k(),G=s=>{s.length===1?m(s[0]):i({title:"Error",description:"Please select exactly one member to view details",status:"error"})},J=async s=>{if(s.length!==1){i({title:"Error",description:"Please select exactly one member to delete",status:"error"});return}const f=s[0];try{await E.delete(`/api/member/${f.id}`),i({title:"Member Deleted Successfully",status:"success"}),j(),p({page:n.page,limit:n.limit,status:l==="all"?void 0:l})}catch(g){let h="Deletion Failed";if(typeof g=="object"&&g!==null&&"response"in g){const v=g.response;v&&v.data&&v.data.message&&(h=v.data.message)}i({title:"Error",description:h,status:"error"})}},W=[{name:"View Details",icon:e.jsx(le,{size:16}),colorScheme:"blue",variant:"solid",onClick:G},{name:"Delete",icon:e.jsx(ae,{size:16}),colorScheme:"red",variant:"outline",onClick:J}],U=s=>{m(s)},X=s=>{b(s),p({page:1,limit:10,status:s==="all"?void 0:s})},K=s=>{C({page:s.current,limit:s.pageSize}),p({page:s.current,limit:s.pageSize,status:l==="all"?void 0:l})};d.useEffect(()=>{p({page:n.page,limit:n.limit,status:l==="all"?void 0:l})},[n.page,n.limit,l]);const Q=()=>{p({page:1,limit:n.limit,search:x,status:l==="all"?void 0:l})},P=d.useMemo(()=>a,[a]),q=d.useMemo(()=>{const s=a.filter(h=>h.status==="APPROVED").length,f=a.filter(h=>h.status==="PENDING").length,g=a.filter(h=>h.status==="REJECTED").length;return{all:a.length,APPROVED:s,PENDING:f,REJECTED:g}},[a]),Y=Ne.map(s=>({...s,name:`${s.name} (${q[s.filter]})`}));return t?e.jsx("div",{className:"mt-7",children:e.jsx(ge,{data:t})}):e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap gap-3",children:[Y.map((s,f)=>e.jsx(O,{onClick:()=>X(s.filter),variant:l===s.filter?"solid":"outline",colorScheme:l===s.filter?"red":"gray",size:"sm",className:"transition-all duration-200",mr:6,mt:1,children:s.name},f)),e.jsx(xe,{placeholder:"Search by Name or Email",value:x,onChange:s=>u(s.target.value),size:"md",width:"300px"}),e.jsx(O,{onClick:Q,colorScheme:"red",children:"Search"})]}),e.jsxs("button",{style:{background:"black",color:"white",padding:"8px 16px",borderRadius:"5px",border:"none",cursor:"pointer"},onClick:()=>{try{const s=D();if(s.length===0){i({title:"No Data",description:"No members found to export",status:"warning"});return}he({data:s,columns:[{key:"ID",header:"ID",width:10},{key:"Full Name",header:"Full Name",width:20},{key:"Phone Number",header:"Phone Number",width:18},{key:"Email",header:"Email",width:30},{key:"Status",header:"Status",width:15}],filename:`members_${l}_${new Date().toISOString().slice(0,10)}.xlsx`,sheetName:"Members",title:`${l==="all"?"All":l.charAt(0)+l.slice(1).toLowerCase()} Members Report`}),i({title:"Export Successful",description:`${s.length} members exported successfully`,status:"success"})}catch(s){console.error("Export failed:",s),i({title:"Export Failed",description:"Failed to export members data",status:"error"})}},children:["Export (",P.length,")"]})]}),e.jsx(re,{data:P,columns:ye,rowKey:"id",showExport:!0,showFilters:!0,tableHeaderBg:"#F1F4F9",tableHeaderColor:"black",showActionBar:!0,actionButtons:W,onRowClick:U,loading:S,pagination:{current:y.page,pageSize:y.limit,total:y.total},onChange:K}),e.jsx(be,{isOpen:r,onClose:$,status:"error",title:"",message:"Member Successfully Deleted"})]})}const He=()=>e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("p",{className:"text-2xl font-bold",children:"Members"})}),e.jsx(ve,{})]});export{He as default};
